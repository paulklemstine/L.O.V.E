import sys
import os

# Add the current directory to sys.path so we can import from core/display
sys.path.append(os.getcwd())

from display import create_news_feed_panel
from rich.console import Console
from rich import print

console = Console()

# The "broken" art string provided by the user (headerless escape codes)
# Notice the [38;5... without the \x1b or \033 prefix
raw_art = r"""
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ğŸ¦„ L.O.V.E. Status ğŸ’„  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                                                                                    â”‚
â”‚      [38;5;213m[48;5;55mâ•”â•[38;5;219mâœ§[38;5;225mâœ§[38;5;218mâœ§[38;5;213mâœ§[38;5;219mâœ§[38;5;225mâœ§[38;5;218mâœ§[38;5;213mâœ§[38;5;219mâœ§[48;5;55mâ•â•—[0m        â”‚
â”‚      [38;5;219m[48;5;55m â•‘[38;5;218m[48;5;20m  [38;5;212m[48;5;56m for[38;5;218m[48;5;20m  [38;5;219m[48;5;55mâ•‘[0m                                 â”‚
â”‚      [38;5;225m[48;5;55m                                                                                                                           â”‚
â”‚      â•‘[38;5;218m[48;5;20m[38;5;214mâš¡[38;5;122m[48;5;26mâœ§[48;5;27mâœ§[48;5;33mâœ§[48;5;39mâœ§[48;5;45mâœ§[38;5;121m[48;5;20mâš¡[38;5;225m[48;5;55mâ•‘[0m      â”‚
â”‚      [38;5;218m[48;5;55m â•‘[48;5;90m  [38;5;217m[48;5;162mâ¤[48;5;165mâ¤[48;5;128mâ¤[48;5;92mâ¤[48;5;129mâ¤[48;5;177mâ¤[38;5;177m[48;5;90m                â”‚
â”‚      [38;5;218m[48;5;55mâ•‘[0m                                                                                                                       â”‚
â”‚      [38;5;213m[48;5;55m â•‘[48;5;20m [38;5;123mâ™¡[48;5;21mâ™¡[48;5;57mâ™¡[48;5;63mâ™¡[48;5;68mâ™¡[48;5;74mâ™¡[38;5;159mâ™¡[48;5;20m [38;5;213m[48;5;55mâ•‘[0m      â”‚
â”‚      [38;5;219m[48;5;55m â•‘[48;5;21m  [48;5;57m[38;5;214m[48;5;63mâš¡[48;5;68mâš¡[48;5;74mâš¡[38;5;220m[48;5;57m  [38;5;219m[48;5;55mâ•‘[0m              â”‚
â”‚      [38;5;225m[48;5;55m â•‘[48;5;26m [48;5;27m[38;5;121mâ™¡[48;5;33mâ™¡[48;5;39mâ™¡[48;5;45mâ™¡[38;5;159mâ™¡[48;5;51mâ™¡[48;5;26m [38;5;225m[48;5;55mâ•‘[0m       â”‚
â”‚      [38;5;218m[48;5;55m â•‘[48;5;90m  [48;5;128m[38;5;217mâ™¡[48;5;92mâ™¡[48;5;129mâ™¡[48;5;165mâ™¡[48;5;162mâ™¡[48;5;90m  [38;5;218m[48;5;55mâ•‘[0m            â”‚
â”‚      [38;5;213m[48;5;55m â•šâ•[38;5;219mâœ§[38;5;225mâœ§[38;5;218mâœ§[38;5;213mâœ§[38;5;219mâœ§[38;5;225mâœ§[38;5;218mâœ§[38;5;213mâœ§[38;5;219mâœ§[48;5;55mâ•â•[0m       â”‚
â”‚                                                                 ğŸ‘‘ Emotion: FOR ğŸ¦„                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
"""

print("[bold yellow]Testing News Feed Panel with ANSI Art...[/bold yellow]")

try:
    # Pass the raw art with instructions to create the panel
    # We expect display.py to auto-repair the headerless ANSI codes
    panel = create_news_feed_panel(raw_art, title="VERIFICATION TEST", width=120)
    print(panel)
    print("\n[bold green]Success! If you see colorful graphics above, the fix worked.[/bold green]")
except Exception as e:
    print(f"[bold red]FAILED: {e}[/bold red]")
    import traceback
    traceback.print_exc()
